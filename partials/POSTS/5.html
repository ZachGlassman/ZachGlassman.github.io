Chain Rule
June 19, 2017
When tutoring differential calculus, I find that one of the hardest concepts for students to grasp is the chain rule.  In this post, we will examine the chain rule and how it might be applied.  We will assume knowledge typical of a calculus I class at the point where the chain rule is taught.

## Why the Chain Rule?

We have already learned to handle many situations where we have two functions $f(x), g(x)$, we combine them together into a single function $y(x)$ and we wish to find the derivative $dy/dx$.  Examples include
$$y(x) = f(x)+g(x)$$
$$y(x) = f(x) - g(x)$$
$$y(x) = f(x)g(x)$$
$$y(x) = f(x)/g(x)$$
\end{align}
These rules will allow us to find derivative for many functions, however, we have yet to learn the derivative for an important situation,
$$y(x) = f(g(x)),$$
where we have whats known as *function composition*.  It is this case for which we will need the chain rule.

We have actually been using the chain rule for a while now without noticing it.  Consider the function $y(x)=x^2$.  We could consider this as a composition of functions $f(g(x))$, where $f(x) = x^2$ and $g(x)=x$.  We know that $dy/dx = 2x$, so we best recover that when we derive the chain rule and figure out how to use it.

## What is the Chain Rule?

We will first state the chain rule without proof (to come later on).  Given two differential functions $f, g$, then
$$ \frac{d}{dx}f(g(x)) = f'(g(x))\cdot g'(x).$$

To get some intutition for this, first recall the intution behind a derivative, it tells how a function is changing in a region around a certain point.  So $f'(a)$, tells us how the function is changing about the point $x=a$.  We can to lowest order approximate this change as $f(a + \Delta x) \approx f(a) + \Delta x f'(a)$.  Thus the change of the function in the region around $a$ is $\Delta x f'(a)$.

Now for the case where our function is $f(g(x))$, we can do the same expnsion about $a$,
$$f(g(a+\Delta x)) \approx f(g(a)) + f'(g(a))[g'(a)\Delta x]$$  The brackets here are meant to be suggestive of one interpretation of the chain rule.  We can think of $g(x)$ as a rescaling of the $x$ axis and the derivative works the same way except we also need to add in an extra factor of $g'$ to rescale $\Delta x$ to make it commensurate with the new rescaled axis.

## Proof of the Chain Rule
We will now provide a proof of the chain rule.  If you only want to see some examples, then skip to the next section. A more complete (although differently notated) version is available at [Chain Rule](https://en.wikipedia.org/wiki/Chain_rule).

Consider two differentiable functions $f(x), g(x)$ which map from the reals to the reals.  Now consider the function $y(x) = f(g(x))$.  We use the definition of the derivative $dy/dx$ to write
$$\frac{dy}{dx} = \lim\_{h\to0}\frac{f(g(x+h))- f(g(x))}{h}=\lim\_{h\to0}\frac{f(g(x+h))- f(g(x))}{h} \cdot \frac{g(x+h)-g(x)}{g(x+h)-g(x)},$$
which is valid as long as $g(x)\neq g(x+h)$ for any $x$ in this regime.  We will need to deal with the case where $g(x) = g(x+h)$ later. For now, assume that $g(x) \neq g(x+h)$ for sufficiently small $h$.

We can now use the fact that if $\lim\_{x\to a}f(x)$ and $\lim\_{x\to a} g(x)$ both exist and are finite then $$\lim\_{x\to a}f(x)g(x)=\lim\_{x\to a}f(x)\cdot\lim\_{x\to a}g(x)$$

This allows us to rearrange some terms as
$$\frac{dy}{dx} =\lim\_{h\to0}\frac{f(g(x+h))- f(g(x))}{g(x+h)-g(x)} \cdot \frac{g(x+h)-g(x)}{h}$$
$$=\lim\_{h\to0}\frac{f(g(x+h))- f(g(x))}{g(x+h)-g(x)} \cdot\lim\_{h\to0} \frac{g(x+h)-g(x)}{h}$$

The second term is simply $g'(x)$ and we can continue for the first term.  We have already assumed that $g(x)$ is differentiable, thus we can we can write for sufficiently small $h$
$$ g(x+h) \approx g(x) + g'(x)h$$
which is a type of linear approximation.  So we can write
$$\lim\_{h\to0}\frac{f(g(x+h))- f(g(x))}{g(x+h)-g(x)}\approx \lim\_{h\to0}\frac{f(g(x) + hg'(x))- f(g(x))}{g'(x)h}$$
and we now note that $g'(x)$ is a finite number, thus we can define $h' = g'(x)h$ and then
$$\lim\_{h\to0}\frac{f(g(x) + hg'(x))- f(g(x))}{g'(x)h}= \lim\_{h'\to0}\frac{f(g(x) + h')- f(g(x))}{h'},$$
which is simply $f'(g(x))$.  This gives us the chain rule which is
$$ \frac{dy}{dx} = f'(g(x))\cdot g'(x).$$

Now we can consider the case where $g(x+h)=g(x)$, in which case our proof fails since we have a division by zero.  However in this case, we also have that $f(g(x+h)) - f(g(x)) = 0$, thus the whole expression is zero.  It is beyond the scope of this post to rigoursly show this, however, the general idea is to introduce piecewise defined function where we define the expression as zero at those points.  The result will follow.

##  When do we use the Chain Rule
Now with the derivation of the chain rule complete, we will write it in a perhaps more useful form.  Given a function $f(u)$, where $u= g(x)$, we can define
$$ \frac{d}{dx} f(u) = f'(u)\cdot u'$$,
where $u'$ is understand as the derivate with respect to the relevant variable.

Lets apply this in the case of $x^2$ (we had better get $2x$!).  In this case, we can define $u=x$ and $f(u) = u^2$.  So the chain rule says
$$\frac{d}{dx} x^2 = 2u * \frac{d}{dx} x = 2u = 2x$$
Luckily, math still works!

In general, we will use the chain rule when we have function composition and *we do not know the derivative*, thus even though it is perfectly acceptable to apply the chain rule to $\frac{d}{dx}x^3$, it is not necessary since we already know this derivative.  A good strategy is to break a function composition into the fewest number of functions possible where all the derivatives are known.

Now we will do a few exmaples.

### Example 1
Find $\frac{d}{dx} \sin(x^2)$.

Let us first define our function $u$. There are several functions we could define as $u$, including $\sin(x^2), x^2, x$.  We don't want to define $u=\sin(x^2)$ as that does not reduce our problem when we need to find $u'$, nor do we want to define $u=x$ as then we are left with $f(u) = \sin(u^2)$ which means we have again not reduced our problem.

So we define $u=x^2$.  Thus, $f(u) = \sin(u)$.  We know the derivatives to **both** these functions, $u' = 2x, f' = \cos(u)$, so the chain rule tells us that
$$\frac{d}{dx} \sin(x^2) = 2x\cos(x^2)$$

### Example 2
Find $\frac{d}{dx} \sin^2(x)$.

Here the two relevant functions are the same as before, namely $\sin(p), p^2$ (here I have used $p$ as a dummy variable so it doesn't get confused with $x$).  The only difference is the order.  So we can define $u=\sin(x)$ and $f(u) = u^2$.  This implies that
$$\frac{d}{dx} \sin^2(x) = 2u * \cos(x) = 2\sin(x)*\cos(x) = \sin(2x),$$
where we have used the  double angle formula.

### Example 3
Find $\frac{d}{dx}\ln(\sqrt{5x-5})$

This is a good problem because there are two reasonable ways to do it (which must give the same answer !).
#### First method
The first method is to brute force repeated applictions of the chain rule.  We will need several steps to do this.  First we can define $u=\sqrt{5x-5}$ and $f(u) = \ln(u)$, thus
$$\frac{d}{dx}\ln(\sqrt{5x-5}) = \frac{1}{u}\frac{d}{dx}u = \frac{1}{\sqrt{5x-5}}\frac{d}{dx}\sqrt{5x-5}$$
Now we can identify a new $u$, $u=5x-5$ and $f(u)=\sqrt{u}$, thus
$$\frac{d}{dx}\ln(\sqrt{5x-5}) = \frac{1}{\sqrt{5x-5}}\frac{1}{2}(u)^{-1/2}5= \frac{1}{2(x-1)},$$
where in the last step we have simplified the expression considerably.

Now let us apply the second method.
#### Second method
First we note that $\ln(x^n) = n\ln(x)$, so we can rewrite
$$\ln(\sqrt{5x-5}) = \frac{1}{2}\ln(5x-5),$$
and defining $u=5x-5$ and $f(u) = \frac{1}{2}\ln(u)$, we have
$$\frac{d}{dx}\ln(\sqrt{5x-5}) = \frac{1}{2u}*5 = \frac{5}{2(5x-5)} = \frac{1}{2(x-1)}.$$

For both cases, we recover the same answer which is a good sign that we have performed the correct steps of differentation.  However, it does bring up a good point, no matter how well you learn derivatives, a good algebra trick to make the problem simpler is a very nice way to save a ton of work.
